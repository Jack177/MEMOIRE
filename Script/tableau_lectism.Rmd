---
title: "IUCN"
author: "Jordan"
date: "`r Sys.Date()`"
output: html_document
---

## Chargement des paquets
```{r Library, message=FALSE, warning=FALSE, include=FALSE, results='hide', paged.print=FALSE}
library("readxl") 
library(dplyr)
library(plotly)
library(ggplot2)
library(viridis) # couleur daltonien
library(tidyr) # fonction gather
library("writexl")
```

## Importation des données
```{r Import, message=FALSE, warning=FALSE, include=FALSE, results='hide', paged.print=FALSE}
# Tour PC
setwd("D:/OneDrive - UMONS/UMONS/MA2/MEMOIRE/Statistique/R/STAT-MEMOIRE/RAW2/Traits abeilles")
# Laptop
#setwd("C:/Users/Jordan/OneDrive - UMONS/UMONS/MA2/MEMOIRE/Statistique/R/STAT-MEMOIRE/RAW2/Traits abeilles")

# Import
traits <- read_excel("Trait-bee-each-site.xlsx")

# Réécriture des noms de familles
traits$familly[traits$familly == "ANDRENIDAE"] <- "Andrenidae"
traits$familly[traits$familly == "APIDAE"] <- "Apidae"
traits$familly[traits$familly == "COLLETIDAE"] <- "Colletidae"
traits$familly[traits$familly == "HALICTIDAE"] <- "Halictidae"
traits$familly[traits$familly == "MEGACHILIDAE"] <- "Megachilidae"
traits$familly[traits$familly == "MELITTIDAE"] <- "Melittidae"
```
Par espèce
```{r}
# Addition des espèces avec la socialité
sociality <- aggregate(N ~ sp + sociality, data = traits, sum)
# Addition des genres avec le substrat de nidification (sol, cavité, branche, vegetation,...)
nest_area <- aggregate(N ~ sp +  Nest_position, data = traits, sum)
# Addition des genres avec la zone de nidification (au dessus du sol ou en dessous)
nest_substrat <- aggregate(N ~ sp + Nest_area, data = traits, sum)
# Addition des genres avec le lectisme (oligo ou poly)
lectism <- aggregate(N ~ sp + Lectism, data = traits, sum)
```

```{r Espèce}
### Abondance des sp
# Socialité abondance-espèces
lectism_abu <-  spread(lectism, key = Lectism , value = N)
# Ajoute une ligne total
lectism_abu <- janitor::adorn_totals(lectism_abu)
# Ajoute une colonne total
lectism_abu$Total <- rowSums(lectism_abu[, c("Oligolectic", "Polylectic")])

lectism_abu$Oligolectic <- as.integer(lectism_abu$Oligolectic)
lectism_abu$Polylectic <- as.integer(lectism_abu$Polylectic)


# Pourcentage abon Oligolectic
pct_abu_oli <- round(lectism_abu[nrow(lectism_abu), "Oligolectic"]/lectism_abu[nrow(lectism_abu), "Total"], digits = 2)
# Pourcentage abon Polylectic
pct_abu_pol <- round(lectism_abu[nrow(lectism_abu), "Polylectic"]/lectism_abu[nrow(lectism_abu), "Total"], 2)


lectism_abu[nrow(lectism_abu) + 1,] = c("Pourcentage", pct_abu_oli,pct_abu_pol,"")




### Richesse 
lectism_rich <- lectism
# Changer tous les chiffres d'abondances par 1
lectism_rich$N[lectism_rich$N > 0] <- 1  
# Tableau avec colonne (Solitaire, clepto, ...)
lectism_rich <-  spread(lectism_rich, key = Lectism , value = N)
# Ajoute une ligne total
lectism_rich <- janitor::adorn_totals(lectism_rich)
# Ajoute une colonne total
lectism_rich$Total <- rowSums(lectism_rich[, c("Oligolectic", "Polylectic")])

# Pourcentage rich Clepto
pct_rich_oli <- round(lectism_rich[nrow(lectism_rich), "Oligolectic"]/lectism_rich[nrow(lectism_rich), "Total"], digits = 2)
# Pourcentage rich Polylectic
pct_rich_pol <- round(lectism_rich[nrow(lectism_rich), "Polylectic"]/lectism_rich[nrow(lectism_rich), "Total"], 2)


lectism_rich[nrow(lectism_rich) + 1,] = c("Pourcentage", pct_rich_oli, pct_rich_pol, "")
```
Par genre
```{r}
# Addition des genres avec la socialité
lectism_gen <- aggregate(N ~ genus + Lectism, data = traits, sum)
```

```{r}
### Abondance des genres
# Socialité abondance-espèces
lectism_gen_abu <-  spread(lectism_gen, key = Lectism , value = N)
# Ajoute une ligne total
lectism_gen_abu <- janitor::adorn_totals(lectism_gen_abu)
# Ajoute une colonne total
lectism_gen_abu$Total <- rowSums(lectism_gen_abu[, c("Oligolectic", "Polylectic")])

# Pourcentage abon Oligolectic
pct_abu_oli <- round(lectism_gen_abu[nrow(lectism_gen_abu), "Oligolectic"]/lectism_gen_abu[nrow(lectism_gen_abu), "Total"], digits = 2)
# Pourcentage abon Polylectic
pct_abu_pol <- round(lectism_gen_abu[nrow(lectism_gen_abu), "Polylectic"]/lectism_gen_abu[nrow(lectism_gen_abu), "Total"], 2)


lectism_gen_abu[nrow(lectism_gen_abu) + 1,] = c("Pourcentage", pct_abu_oli,pct_abu_pol,pct_abu_par,pct_abu_sol,"")


### Richesse des genres
lectism_gen_rich <- lectism_gen
# Changer tous les chiffres d'abondances par 1
lectism_gen_rich$N[lectism_gen_rich$N > 0] <- 1  
# Tableau avec colonne (Polylectic, Oligolectic, ...)
lectism_gen_rich <-  spread(lectism_gen_rich, key = Lectism , value = N)
# Ajoute une ligne total
lectism_gen_rich <- janitor::adorn_totals(lectism_gen_rich)
# Ajoute une colonne total
lectism_gen_rich$Total <- rowSums(lectism_gen_rich[, c("Oligolectic", "Polylectic")])

# Pourcentage rich Oligolectic
pct_rich_oli <- round(lectism_gen_rich[nrow(lectism_gen_rich), "Oligolectic"]/lectism_gen_rich[nrow(lectism_gen_rich), "Total"], digits = 2)
# Pourcentage rich Polylectic
pct_rich_pol <- round(lectism_gen_rich[nrow(lectism_gen_rich), "Polylectic"]/lectism_gen_rich[nrow(lectism_gen_rich), "Total"], 2)


lectism_gen_rich[nrow(lectism_gen_rich) + 1,] = c("Pourcentage", pct_rich_oli,pct_rich_pol,pct_rich_par,pct_rich_sol,"")
```

```{r}
# Exportation tableur Excel
write_xlsx(category_IUCN_fam,"D:/OneDrive - UMONS/UMONS/MA2/MEMOIRE/Statistique/R/STAT-MEMOIRE/Output/lectism.xlsx")
```